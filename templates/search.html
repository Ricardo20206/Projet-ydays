{% extends "base.html" %}

{% block content %}
<script>
    window.currentMedia = {
        video: null,
        image: null
    };
</script>
<div class="page-content">
    <h1 style="color: #2a2a2a; margin-bottom: 30px;">ğŸ” Recherche</h1>
    
    <div class="search-bar" style="max-width: 100%; margin-bottom: 30px;">
        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input type="text" placeholder="Comment puis-je vous aider ?" id="searchInput" value="{{ query }}">
    </div>
    
    {% if query %}
    <div class="info-section">
        <h2>RÃ©sultats de recherche pour : "{{ query }}"</h2>
        <div id="searchResults">
            <p>â³ Traitement de votre requÃªte par l'API...</p>
        </div>
    </div>
    {% else %}
    <div class="info-section">
        <h2>Rechercher vos mÃ©dias</h2>
        <p>Utilisez la barre de recherche ci-dessus pour trouver vos vidÃ©os et images.</p>
        <p>Tapez votre requÃªte et appuyez sur EntrÃ©e pour lancer la recherche.</p>
        <p style="margin-top: 15px; color: #666; font-size: 14px;">
            <strong>Note :</strong> Votre requÃªte sera automatiquement transmise Ã  l'API externe pour traitement.
        </p>
    </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');
    
    // Si une requÃªte est prÃ©sente dans l'URL, afficher les rÃ©sultats
    {% if query %}
    fetch('/send-query-to-api', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ query: "{{ query }}" })
    })
    .then(response => response.json())
    .then(data => {
        if (searchResults) {
            if (data.status === 'success') {
                searchResults.innerHTML = `
                    <div class="status-message status-success" style="margin-bottom: 20px;">
                        âœ… ${data.response || 'RequÃªte traitÃ©e avec succÃ¨s'}
                    </div>
                    <p><strong>RequÃªte :</strong> "${data.query}"</p>
                    <p><strong>Timestamp :</strong> ${data.timestamp || 'N/A'}</p>
                    <p style="margin-top: 20px;">FonctionnalitÃ© de recherche avancÃ©e en cours de dÃ©veloppement...</p>
                `;
            } else {
                searchResults.innerHTML = `
                    <div class="status-message status-error">
                        âŒ Erreur : ${data.error || 'Erreur lors du traitement'}
                    </div>
                `;
            }
        }
    })
    .catch(error => {
        if (searchResults) {
            searchResults.innerHTML = `
                <div class="status-message status-error">
                    âŒ Erreur de connexion Ã  l'API externe
                </div>
            `;
        }
        console.error('Erreur:', error);
    });
    {% endif %}
    
    if (searchInput) {
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const query = this.value.trim();
                if (query) {
                    window.location.href = `/search?q=${encodeURIComponent(query)}`;
                }
            }
        });
    }
});
</script>
{% endblock %}
