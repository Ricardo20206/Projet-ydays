<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Complet des Formes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
        #testCanvas {
            border: 2px solid #333;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>ðŸ§ª Test Complet des Formes</h1>
    
    <div class="test-section">
        <h2>1. Test de Base</h2>
        <button onclick="testBasicFunctions()">Tester les fonctions de base</button>
        <div id="basicResults"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Test du Canvas</h2>
        <button onclick="testCanvas()">Tester le canvas</button>
        <div id="canvasResults"></div>
        <canvas id="testCanvas" width="400" height="300"></canvas>
    </div>
    
    <div class="test-section">
        <h2>3. Test de Dessin</h2>
        <button onclick="testDrawing()">Tester le dessin d'une forme</button>
        <div id="drawingResults"></div>
    </div>
    
    <div class="test-section">
        <h2>4. Instructions pour tester dans l'application</h2>
        <ol>
            <li>Ouvrir l'application Flask</li>
            <li>Charger une image</li>
            <li>Ouvrir la console du navigateur (F12)</li>
            <li>Copier-coller le code suivant dans la console :</li>
        </ol>
        <textarea id="testCode" style="width: 100%; height: 200px; font-family: monospace;">
// Test complet dans l'application
console.log('=== TEST COMPLET ===');

// 1. VÃ©rifier window.selectShape
console.log('1. window.selectShape:', typeof window.selectShape);

// 2. VÃ©rifier window.drawShape
console.log('2. window.drawShape:', typeof window.drawShape);

// 3. VÃ©rifier window.canvas
console.log('3. window.canvas:', !!window.canvas, window.canvas ? {
    width: window.canvas.width,
    height: window.canvas.height,
    style: {
        display: window.canvas.style.display,
        visibility: window.canvas.style.visibility,
        zIndex: window.canvas.style.zIndex
    }
} : null);

// 4. VÃ©rifier window.ctx
console.log('4. window.ctx:', !!window.ctx);

// 5. VÃ©rifier window.addedElements
console.log('5. window.addedElements:', window.addedElements ? window.addedElements.length : 0);

// 6. VÃ©rifier l'image
const img = document.getElementById('editableImage');
console.log('6. Image:', !!img, img ? {
    naturalWidth: img.naturalWidth,
    naturalHeight: img.naturalHeight,
    rect: img.getBoundingClientRect()
} : null);

// 7. Tester selectShape
if (typeof window.selectShape === 'function') {
    console.log('7. Test: Appel de selectShape("square")...');
    window.selectShape('square');
    
    // VÃ©rifier aprÃ¨s 1 seconde
    setTimeout(() => {
        console.log('8. AprÃ¨s appel:');
        console.log('   - window.addedElements:', window.addedElements ? window.addedElements.length : 0);
        console.log('   - window.selectedElement:', window.selectedElement);
        
        // VÃ©rifier visuellement
        const canvas = window.canvas || document.getElementById('editingCanvas');
        if (canvas) {
            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            let hasYellow = false;
            for (let i = 0; i < imageData.data.length; i += 4) {
                const r = imageData.data[i];
                const g = imageData.data[i + 1];
                const b = imageData.data[i + 2];
                // VÃ©rifier si c'est du jaune (#FFD700 = rgb(255, 215, 0))
                if (r > 200 && g > 200 && b < 50) {
                    hasYellow = true;
                    break;
                }
            }
            console.log('9. Jaune dÃ©tectÃ© sur le canvas:', hasYellow);
        }
    }, 1000);
}
        </textarea>
        <button onclick="copyTestCode()">Copier le code</button>
    </div>
    
    <script>
        function addResult(containerId, message, type) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            container.appendChild(div);
        }
        
        function testBasicFunctions() {
            const container = document.getElementById('basicResults');
            container.innerHTML = '';
            
            // Test 1
            if (typeof window !== 'undefined') {
                addResult('basicResults', 'âœ“ window est dÃ©fini', 'success');
            } else {
                addResult('basicResults', 'âœ— window n\'est pas dÃ©fini', 'error');
            }
            
            // Test 2
            if (typeof Array !== 'undefined') {
                addResult('basicResults', 'âœ“ Array est dÃ©fini', 'success');
            } else {
                addResult('basicResults', 'âœ— Array n\'est pas dÃ©fini', 'error');
            }
            
            // Test 3
            try {
                const testArray = [];
                testArray.push({test: 1});
                addResult('basicResults', 'âœ“ Array.push fonctionne', 'success');
            } catch (e) {
                addResult('basicResults', 'âœ— Array.push ne fonctionne pas: ' + e.message, 'error');
            }
        }
        
        function testCanvas() {
            const container = document.getElementById('canvasResults');
            container.innerHTML = '';
            
            const canvas = document.getElementById('testCanvas');
            if (!canvas) {
                addResult('canvasResults', 'âœ— Canvas de test non trouvÃ©', 'error');
                return;
            }
            
            addResult('canvasResults', 'âœ“ Canvas de test trouvÃ©', 'success');
            
            const ctx = canvas.getContext('2d');
            if (!ctx) {
                addResult('canvasResults', 'âœ— Contexte 2D non disponible', 'error');
                return;
            }
            
            addResult('canvasResults', 'âœ“ Contexte 2D disponible', 'success');
            
            // Tester le dessin
            try {
                ctx.fillStyle = '#FFD700';
                ctx.fillRect(50, 50, 100, 100);
                addResult('canvasResults', 'âœ“ Dessin d\'un rectangle jaune rÃ©ussi', 'success');
            } catch (e) {
                addResult('canvasResults', 'âœ— Erreur lors du dessin: ' + e.message, 'error');
            }
        }
        
        function testDrawing() {
            const container = document.getElementById('drawingResults');
            container.innerHTML = '';
            
            const canvas = document.getElementById('testCanvas');
            if (!canvas) {
                addResult('drawingResults', 'âœ— Canvas non trouvÃ©', 'error');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            if (!ctx) {
                addResult('drawingResults', 'âœ— Contexte non disponible', 'error');
                return;
            }
            
            // Simuler drawShape
            try {
                const shapeType = 'square';
                const x = 150;
                const y = 100;
                const width = 100;
                const height = 100;
                
                ctx.strokeStyle = '#FFD700';
                ctx.fillStyle = 'rgba(255, 215, 0, 0.3)';
                ctx.lineWidth = 3;
                ctx.fillRect(x, y, width, height);
                ctx.strokeRect(x, y, width, height);
                
                addResult('drawingResults', 'âœ“ Forme carrÃ©e dessinÃ©e avec succÃ¨s', 'success');
                addResult('drawingResults', '  Position: (' + x + ', ' + y + ')', 'info');
                addResult('drawingResults', '  Taille: ' + width + 'x' + height, 'info');
                addResult('drawingResults', '  Couleur: #FFD700 (jaune)', 'info');
            } catch (e) {
                addResult('drawingResults', 'âœ— Erreur lors du dessin: ' + e.message, 'error');
            }
        }
        
        function copyTestCode() {
            const textarea = document.getElementById('testCode');
            textarea.select();
            document.execCommand('copy');
            alert('Code copiÃ© dans le presse-papiers !');
        }
        
        // Tests automatiques au chargement
        window.addEventListener('load', function() {
            setTimeout(() => {
                testBasicFunctions();
                testCanvas();
            }, 500);
        });
    </script>
</body>
</html>
